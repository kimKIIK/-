<!DOCTYPE html>
<html lang="ko">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
	<meta name="description" content="대한민국 대통령 공식 홈페이지">
	<meta name="keywords" content="대한민국대통령, 윤석열, 탄핵하라, 제20대 대통령은, 이제, 탄핵속으로 사라져라, 국민의 짐, 윤대통령, 제20대 대통령 윤석열 퇴진하라">

	<meta property="og:type" content="website">
	<meta property="og:title" content="대한민국 대통령실">
	<meta property="og:url" content="https://www.president.go.kr">
	<meta property="og:site_name" content="대한민국 대통령실">
	<meta property="og:description" content="대한민국 대통령 공식 홈페이지">
	<meta property="og:image" content="https://www.president.go.kr/thumb_img_new.jpg">
    <style>
        /* 스타일 그대로 유지 */
        @import url(/assets/css/fonts/pretendard/font.css);
        html, body, div, p, a, span, ul, li, h3 {
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', sans-serif;
        }
        a { text-decoration: none; }
        .container {
            width: 100%;
            height: auto;
            display: table;
        }
        .contents {
            position: relative;
            display: table-cell;
            vertical-align: middle;
            width: 100%;
            margin: 0 auto;
            text-align: center;
        }
        .comment-section {
            margin-top: 50px;
            text-align: left;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
        .comment-section h4 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .comment-section .comment {
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .comment-section .delete-btn {
            color: red;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        .comment-section textarea, .comment-section input {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .comment-section .submit-btn {
            background-color: #082e59;
            color: #fff;
            border: none;
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
	<title>댓글 및 공지사항</title>
</head>
<body>

<div class="container">
	<div class="contents">
		<h3>댓글 및 공지사항</h3>
	</div>
</div>

<div class="comment-section">
	<div class="announcement" id="announcement">
		관리자 공지: 여기에 공지 내용을 작성하세요.
	</div>
	<div class="admin-announcement" id="adminAnnouncement" style="display:none;">
		<textarea id="announcementInput" placeholder="공지 내용을 작성하세요"></textarea>
		<button class="submit-btn" onclick="updateAnnouncement()">공지 등록</button>
	</div>

	<h4>댓글 작성</h4>
	<textarea id="commentInput" placeholder="댓글을 입력하세요"></textarea>
	<input id="nicknameInput" type="text" placeholder="닉네임을 입력하세요">
	<button class="submit-btn" onclick="addComment()">댓글 작성</button>

	<div id="comments" style="margin-top: 20px;"></div>
</div>

<script>
	const commentsContainer = document.getElementById('comments');
	const announcementElement = document.getElementById('announcement');
	const adminAnnouncementElement = document.getElementById('adminAnnouncement');
	let commentsData = [];

	// 서버에서 댓글 데이터를 가져오는 함수
	async function loadCommentsFromServer() {
		try {
			const response = await fetch('/get-comments');
			commentsData = await response.json();
			renderComments();
		} catch (error) {
			console.error('댓글 불러오기 오류:', error);
		}
	}

	// 댓글 데이터를 서버에 저장하는 함수
	async function saveCommentToServer(comment, nickname) {
		try {
			await fetch('/save-comment', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ nickname, comment })
			});
		} catch (error) {
			console.error('댓글 저장 오류:', error);
		}
	}

	// 댓글 추가
	async function addComment() {
		const commentInput = document.getElementById('commentInput');
		const nicknameInput = document.getElementById('nicknameInput');
		const comment = commentInput.value.trim();
		const nickname = nicknameInput.value.trim();

		if (!comment || !nickname) {
			alert('닉네임과 댓글을 모두 입력해주세요.');
			return;
		}

		await saveCommentToServer(comment, nickname);
		commentsData.unshift({ nickname, comment });
		commentInput.value = '';
		nicknameInput.value = '';
		renderComments();
	}

	// 댓글 렌더링
	function renderComments() {
		commentsContainer.innerHTML = '';
		commentsData.forEach(({ nickname, comment }) => {
			const commentElement = document.createElement('div');
			commentElement.className = 'comment';
			commentElement.innerHTML = `<span>${nickname}</span>: ${comment}`;
			commentsContainer.appendChild(commentElement);
		});
	}

	// 공지사항 업데이트
	async function updateAnnouncement() {
		const announcementInput = document.getElementById('announcementInput').value.trim();
		if (announcementInput) {
			try {
				await fetch('/update-announcement', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ announcement: announcementInput })
				});
				announcementElement.textContent = `관리자 공지: ${announcementInput}`;
			} catch (error) {
				console.error('공지 업데이트 오류:', error);
			}
		}
	}

	// 페이지 로드 시 초기화
	window.onload = async () => {
		try {
			const announcementResponse = await fetch('/get-announcement');
			const { announcement } = await announcementResponse.json();
			announcementElement.textContent = `관리자 공지: ${announcement}`;
		} catch (error) {
			console.error('공지 불러오기 오류:', error);
		}

		await loadCommentsFromServer();
	};
</script>

</body>
</html>
